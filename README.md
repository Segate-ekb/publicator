[![Chat on Telegram 1c DevOps](https://img.shields.io/badge/chat-Telegram-brightgreen.svg)](https://t.me/DevOps_onec)

# Публикатор баз 1с

Это механизм удобной и быстрой публикации баз 1с на веб-сервере.

## Зачем все это?

Повысить удобство управления публикацями баз 1с, дать возможность публиковать базы разработчиков в тестовом контуре без доступа на сервер.

## Установка

На данный момент возможно 2 способа испоьзования продукта:

1. Docker-контейнер.
    
    Из-за лицензионной политики 1с, не получается собрать уже готовые образы и выложить их в хаб, потому для начала работы необходимо собрать image.
    Для этого выполните несколько действий:

    * Переименуйте [.onec.env.example](/.onec.env.example) в onec.env
    * Заполните необходимые параметры
    * Запустите скрипт [build-publicator.sh](/build-publikator.sh)
    * Если вдруг, автоматически скачать релиз с сайта 1с не получается, то его можно положить в каталог [/webserver/distr](/webserver/distr/)

    После сборки необходимо заполнить параметры вашего приложения:

    * Переименовать [config.json.example](/volumes/config.json.example)
    * Описать в конфиге публикацию вашей базы. (можно сделать позже. после запуска)
    * прописать в [docker-compose.yaml](/docker-compose.yaml) image созданый на этапе сборки

    Все! можно запускать приложение:

    `docker-compose up -d`

2. Взять приложение из списка релизов.
    * Скачать архив
    * Распаковать
    * Внести в файл `autumn-properties.json` изменения, указав путь к вашему апач, и путь к 1с и к каталогу публикаций. И запустить `oscript main.os`

## Использование

Для удобства использования реализован веб интерфейс, доступный по порту :3333

![Веб-интерфейс](/docs/img/web.png)

Здесь можно отредактировать/сохранить конфигурацию и перезапустить веб-сервер apache.

## Структура конфига
Посмотреть пример конфига можно в файле [config.json.example](/volumes/config.json.example)
### bases

Массив со списком информационных баз 1с. На жанный момент поддерживаются только серверные варианты баз

Потому обязаельно надо заполнить свойства `Srvr` и `Ref`
### publications

Массив публикаций конкртеной базы. Их может быть несколько. Например в одна для использование веб-интерфейса, а другая для публикации анонимных http-сервисов

Можно указать логин и пароль для авторизации в БД, а так же признак `enable` разрешающий или запрещающий вход.
### ws

Секция описывающая веб сервисы публикации. Состоит из массива `wsList`, а так же из опции `publishExtensionsByDefault`

### httpServices

Секция описывающая http-сервисы публикации. Состоит из массива `hsList`, а так же свойств `publishExtensionsByDefault` и `publishByDefault`

### oidc

Секция описывающая подключение по openid connect. содерит в себе массив `providers` описание заполнения этого масссива можно найти на ИТС
## To-do
Что будет дорабатываться:

* Добавить схему json для подсказок и валидации
* В ближайших планах, все таки понять как рисовать красивый фронт и сделать конструктор публикаций без прямого редактирования конфигурации

## Спасибо

* Разработчикам фреймворка autumn! C желудями жизнь становится сильно проще и красочнее
* Разработчикам веб-сервера [winow](https://github.com/autumn-library/winow)
